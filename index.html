<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Driver Attendance</title>
</head>
<body style="font-family: Arial; text-align: center; padding-top: 40px;">

  <h3>Driver Attendance</h3>
  <p>Please allow location access</p>

  <button id="btn" onclick="markAttendance()"
    style="padding:12px 20px;font-size:16px;">
    Mark Attendance
  </button>

  <script>
    const qrId = new URLSearchParams(window.location.search).get("qr_id");

    function markAttendance() {
      if (!qrId) {
        alert("Invalid QR");
        return;
      }

      const btn = document.getElementById("btn");
      btn.disabled = true;
      btn.innerText = "Recording...";

      navigator.geolocation.getCurrentPosition(
        pos => {
          fetch("https://script.google.com/macros/s/AKfycbznKrCS_9lw8C9fVczJXe8rotxIeVuFQ0d9OOoQqbp2G2a62EbOksstQ-GMG2O0Rej6Qg/exec", {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({
              qr_id: qrId,
              lat: pos.coords.latitude,
              lng: pos.coords.longitude
            })
          });

          alert("Attendance recorded");
          btn.innerText = "Done âœ…";
        },
        () => {
          alert("Location permission required");
          btn.disabled = false;
          btn.innerText = "Mark Attendance";
        }
      );
    }
  </script>

</body>
</html>
