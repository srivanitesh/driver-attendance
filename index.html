<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Driver Attendance</title>
</head>
<body style="font-family:sans-serif;text-align:center;">
  <h3>Driver Attendance</h3>
  <p>Please allow location access</p>
  <button onclick="mark()">Mark Attendance</button>

 <script>
  alert("Script loaded");

  const params = new URLSearchParams(window.location.search);
  const STORE = params.get("store");
  const DRIVER = params.get("driver");

  alert("Params â†’ store=" + STORE + " driver=" + DRIVER);

  function mark() {
    alert("Mark button clicked");

    if (!STORE || !DRIVER) {
      alert("Invalid QR");
      return;
    }

    if (!navigator.geolocation) {
      alert("Geolocation not supported");
      return;
    }

    alert("Requesting location");

    navigator.geolocation.getCurrentPosition(
      function(pos) {
        alert("Location received");

        fetch("YOUR_APPS_SCRIPT_URL", {
          method: "POST",
          mode: "no-cors",
          headers: {
            "Content-Type": "text/plain"
          },
          body: JSON.stringify({
            store: STORE,
            driver: DRIVER,
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
          })
        })
        .then(() => alert("Fetch sent"))
        .catch(() => alert("Fetch failed"));
      },
      function(err) {
        alert("Location error: " + err.message);
      }
    );
  }
</script>
</body>
</html>
