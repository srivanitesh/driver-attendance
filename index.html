<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Driver Attendance</title>
</head>
<body style="font-family:sans-serif;text-align:center;">
  <h3>Driver Attendance</h3>
  <p>Please allow location access</p>
  <button onclick="mark()">Mark Attendance</button>

<script>
  const params = new URLSearchParams(window.location.search);
  const STORE = params.get("store");
  const DRIVER = params.get("driver");

  function mark() {
    if (!STORE || !DRIVER) {
      alert("Invalid QR");
      return;
    }

    if (!navigator.geolocation) {
      alert("Location not supported");
      return;
    }

    const btn = document.querySelector("button");
    btn.disabled = true;
    btn.innerText = "Marking attendance...";

    navigator.geolocation.getCurrentPosition(
      function(pos) {
        fetch("https://script.google.com/macros/s/AKfycbxjZErxZJTQpyXkljmYLYcSg07UZT2ZQyAfZXnYs_SXcB918MzVuP7QwVD9u-usgeHA/exec", {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "text/plain" },
          body: JSON.stringify({
            store: STORE,
            driver: DRIVER,
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
          })
        });

        alert("Attendance recorded");
        btn.innerText = "Attendance marked âœ…";
      },
      function() {
        alert("Location permission required");
        btn.disabled = false;
        btn.innerText = "Mark Attendance";
      }
    );
  }
</script>
</body>
</html>
